<html>
  <head>
    <title>resources - «Draft» Ubiregi API</title>
    <meta charset='utf-8' />
    <link href='bootstrap.min.css' rel='stylesheet' />
    <link href='top.css' rel='stylesheet' />
  </head>
  <body>
    <div class='topbar'>
      <div class='topbar-inner'>
        <div class='container'>
          <div class='row'>
            <h3><a href='index.html'>Ubiregi API</a></h3>
            <ul class='nav'>
              <li class='registration'><a href='registration.html'>Registration</a></li>
              <li class='authentication'><a href='authentication.html'>Authentication</a></li>
              <li class='resources'><a href='resources.html'>Resources</a></li>
              <li class='errors'><a href='errors.html'>Errors</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class='container' style='margin-top:60px; margin-bottom:2em'>
      <div class='row'>
        <div class='span12 offset2'>
          <h3 style='color: red; text-align:center; font-family:Papyrus; font-weight:normal; background-color:#FED; margin-bottom:1em'>
            Draft; we are still working for this docs.
          </h3>
        </div>
      </div>
      <script src='jquery.js'></script>
      <script src='bootstrap-tabs.js'></script>
      <ul class='tabs' data-tabs='tabs'>
        <li class='active'><a href='#general-notes'>General Notes</a></li>
        <li><a href='#objects'>Objects</a></li>
        <li><a href='#resources'>Resources</a></li>
      </ul>
      <div class='tab-content'>
        <div class='active tab-pane' id='general-notes'>
          <h2>Meta variables</h2>
          <dl>
            <dt>$<em>type</em></dt>
            <dd>Object of <em>type</em>.</dd>
            <dt>$<em>type</em><code>s</code></dt>
            <dd>
              Sequence of objects of <em>type</em>.
              Usually contents of an array.
            </dd>
            <dt>$base64Encoded</dt>
            <dd>Base64 encoded string of a binary data.</dd>
            <dt>$UUID-like-sequence</dt>
            <dd>
              String which is expected to be unique in the world.
              It is UUID in the case the sequence is generated in server.
              If it is generated by iOS, it is not an exact UUID but an extended one by Apple.
            </dd>
            <dt>$Time</dt>
            <dd>ISO8601 format string of a time.</dd>
          </dl>
          <h2>Standard Set of APIs on Collection</h2>
          <p>
            Most resource collections provides the following set of APIs.
          </p>
          <ul>
            <li>Retrieving the collection (Index)</li>
            <li>Creating or updating items (POST)</li>
            <li><strong>Optional</strong>: Retrieving one item (GET)</li>
          </ul>
          <h2>Standard Index Parameters</h2>
          <p>
            Indexing actions take a set of parameters; <code>since</code>, <code>until</code>, and <code>glb</code>.
            They are used to limit the size of the result sets.
          </p>
          <table>
            <tr>
              <th><code>since</code></th>
              <td>Limits the result set to contain only updated items since the parameter.</td>
            </tr>
            <tr>
              <th><code>until</code></th>
              <td>Limits the result set to reject items updated since the parameter.</td>
            </tr>
            <tr>
              <th><code>glb</code></th>
              <td>Greatest lower bound of id of the result set. This is used to retrieve next batch of the collection.</td>
            </tr>
          </table>
          <p>The result set can be described as follows:</p>
          <blockquote>{ item | since ≤ item.updated_at ⋀ item.updated_at < until ⋀ glb < item.id }</blockquote>
          <p>The items are sorted by their <code>id</code>s.</p>
          <p>The result will be on following pattern.</p>
          <pre>{&#x000A;  &quot;timestamp&quot;: $Timestamp,&#x000A;  &quot;next-url&quot;: $URL,&#x000A;  &quot;last-updated-at&quot;: $Timestamp,&#x000A;  $rows: [ $objects ],&#x000A;}</pre>
          <dl>
            <dt>timestamp</dt>
            <dd>
              <p>The server time.
              This is sent for the case client local clock is incorrect.
              If <code>until</code> parameter is specified, <code>timestamp</code> will be the requested <code>until</code>.</p>
            </dd>
            <dt>next-url (optional)</dt>
            <dd>
              The URL to retrieve next result set.
              This will be unspecified in the case there are no more results.
            </dd>
            <dt>last-updated-at</dt>
            <dd>
              The timestamp on the time, there were last update of an object which belongs to the resource you requested.
            </dd>
            <dt>$rows</dt>
            <dd>
              <p>Array of objects.
              The name will be different, <code>items</code> for MenuItems, <code>categories</code> for Categories, and <code>checkouts</code> for Checkouts.</p>
            </dd>
          </dl>
          <h3>Fetching Whole Collection</h3>
          <p>There are limitation on the number of objects contained in one request; this is the reason we accept <code>glb</code> parameter.
          You might have a question that how to get the whole collection?
          A set of requests to fetch collections can be interleaved by requests which updates objects which is contained in the collection.
          In that case, the <code>updated_at</code> field will be updated and because of the <code>until</code> parameter included in the fetch request, the updated objects can not be fetched.</p>
          <p><code>last-updated-at</code> field is to handle such case.
          If there are no <code>next-url</code> field sent, which means there are no more object for the parameters you specified, check if the <code>timestamp</code> field is newer than <code>last-updated-at</code>.</p>
          <ol>
          <li>Send a request without <code>until</code> and <code>glb</code> parameters.</li>
          <li>Check if the response contains <code>next-url</code> field.</li>
          <li>If contains, fetch the <code>next-url</code> and go step 2 again.</li>
          <li>If not caintains, send a request again but with <code>since</code> = <code>timestamp</code>, and got step 2 again.</li>
          </ol>
          <h2>POST Convention</h2>
          <p>
            POST actions to collection create or update more than one items.
            This helps to make updating many items faster.
          </p>
          <p>
            The request will be like the following:
          </p>
          <pre>[&#x000A;  { &quot;name&quot;: &quot;new object&quot;, ... },&#x000A;  { &quot;name&quot;: &quot;another new object&quot;, ...},&#x000A;  { &quot;id&quot;: 123, &quot;name&quot;: &quot;object to be updated&quot; },&#x000A;]</pre>
          <ul>
          <li>If there are no <code>id</code> field in an object, it will create new item.</li>
          <li>If there are <code>id</code> field in an object, it will update an existing item.</li>
          </ul>
          <p>The post action is transactional.
          If there are an error processing an item, all creation or update of items will be canceled.
          There will be one of <em>everything ok</em> or <em>nothing changed</em>.</p>
          <p>There is no limitation on number of objects in one request, but you should take care of it.
          100 items in a request will be ok. 10,000 items in a request should cause a problem.
          We will ask you to stop posting too big request, if there are some problem.</p>
        </div>
        <div class='tab-pane' id='objects'>
          <p>Every object has <code>created_at</code> and <code>updated_at</code> fields.</p>
          <h2>Account</h2>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>Account ID.</dd>
                <dt>login (optional)</dt>
                <dd>Account's login</dd>
                <dt>email (optional)</dt>
                <dd>Account's email</dd>
                <dt>name</dt>
                <dd>Account name to be displayed to users.</dd>
                <dt>expire_at (optional)</dt>
                <dd>
                  Expiration data.
                  May be `null` in the case there is no expiration on subscription.
                </dd>
                <dt>subscription</dt>
                <dd>One of `trial`, `standard`, and `expired`.</dd>
                <dt>currency</dt>
                <dd>One of `JPY`, `USD`, `Unknown 2`, and `Unknown 3`.</dd>
                <dt>date_offset</dt>
                <dd>
                  The hour date changes.
                  If this is `6`, the date changes at 6 AM, ie 2012-01-01T05:59:00Z is December 31, 2011 (If the timezone is UTC).
                </dd>
                <dt>timezone</dt>
                <dd>Timezone.</dd>
                <dt>receipt_title</dt>
                <dd>Receipt title.</dd>
                <dt>receipt_footer</dt>
                <dd>Footer text to be printed on receipt.</dd>
                <dt>receipt_logo</dt>
                <dd>Base64 encoded logo image to be printed on receipt.</dd>
                <dt>menus</dt>
                <dd>Array of menu ids.</dd>
                <dt>tables</dt>
                <dd>Array of tables.</dd>
                <dt>customer_tags</dt>
                <dd>Array of customer tags.</dd>
                <dt>payment_types</dt>
                <dd>Array of payment types.</dd>
                <dt>cashiers</dt>
                <dd>Array of cashiers.</dd>
                <dt>friends</dt>
                <dd>Array of parent or child accounts.</dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 123,&#x000A;  &quot;login&quot;: &quot;ubiregi-cafe&quot;,&#x000A;  &quot;email&quot;: &quot;cafe@ubiregi.com&quot;,&#x000A;  &quot;name&quot;: &quot;Ubiregi Cafe&quot;,&#x000A;  &quot;expire_at&quot;: &quot;2011-11-13T00:00:00Z&quot;,&#x000A;  &quot;subscription&quot;: &quot;standard&quot;,&#x000A;  &quot;currency&quot;: &quot;JPY&quot;,&#x000A;  &quot;date_offset&quot;: 6,&#x000A;  &quot;timezone&quot;: &quot;Asia/Tokyo&quot;,&#x000A;  &quot;receipt_title&quot;: &quot;RECEIPT&quot;,&#x000A;  &quot;receipt_footer&quot;: &quot;This is footer to be printed in receipts&quot;,&#x000A;  &quot;receipt_logo&quot;: $base64Encoded,&#x000A;  &quot;menus&quot;: [ 8 ],&#x000A;  &quot;tables&quot;: [ $tables ],&#x000A;  &quot;customer_tags&quot;: [ $customer_tags ],&#x000A;  &quot;payment_types&quot;: [ $payment_types ],&#x000A;  &quot;cashiers&quot;: [ $cashiers ],&#x000A;  &quot;friends&quot;: [ $friends ],&#x000A;}</pre>
            </div>
          </div>
          <h2>Table</h2>
          <p><strong>Table object is deprecated.</strong>
          It is working now but will be obsoleted soon.</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of the object.</dd>
                <dt>name</dt>
                <dd>Name of the table.</dd>
                <dt>position</dt>
                <dd>Position of the table.</dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 123,&#x000A;  &quot;name&quot;: &quot;Table 1&quot;,&#x000A;  &quot;position&quot;: 3,&#x000A;}</pre>
            </div>
          </div>
          <h2>Customer Tag</h2>
          <p>Tags to give various information on checkouts.
          This can be used to record that <em>the customer is 20th girl</em>, <em>they came for dating</em>, and so on.</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of the object.</dd>
                <dt>name</dt>
                <dd>Name of the tag.</dd>
                <dt>position (optional)</dt>
                <dd>Position of the tag. <code>null</code> in the case the tag is deleted.</dd>
                <dt>icon</dt>
                <dd>Icon image for the tag.</dd>
                <dt>icon_mime</dt>
                <dd>MIME type of the icon. Usually <code>image/png</code>.</dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 123,&#x000A;  &quot;name&quot;: &quot;Dating&quot;,&#x000A;  &quot;potision&quot;: null,&#x000A;  &quot;icon&quot;: $base64Encoded,&#x000A;  &quot;icon_mime&quot;: &quot;image/png&quot;,&#x000A;}</pre>
            </div>
          </div>
          <h2>PaymentType</h2>
          <p>How the bill is payed by; cash? or credit card?</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of the object.</dd>
                <dt>name</dt>
                <dd>Name of the payment type.</dd>
                <dt>position (optional)</dt>
                <dd>
                  <p>Position of the type. <code>null</code> in the case the payment methods is disabled.</p>
                </dd>
                <dt>change</dt>
                <dd>
                  <p><code>true</code> if customers will receive change.</p>
                </dd>
                <dt>kind</dt>
                <dd>
                  <p><code>CASH</code> | <code>CARD</code> | <code>OTHER</code><br/>
                  One <code>CASH</code> kind payment type exists all accounts.</p>
                </dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 111,&#x000A;  &quot;name&quot;: &quot;Credit card&quot;,&#x000A;  &quot;position&quot;: 3,&#x000A;  &quot;change&quot;: true,&#x000A;  &quot;kind&quot;: &quot;CARD&quot;,&#x000A;}</pre>
            </div>
          </div>
          <h2>Cashier</h2>
          <p>Cashier who operated the cash register.</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of the object.</dd>
                <dt>name</dt>
                <dd>Name of the cashier.</dd>
                <dt>enabled</dt>
                <dd>
                  <p><code>true</code> if the cashier is enabled. <code>false</code> if the cashier is deleted.</p>
                </dd>
                <dt>icon</dt>
                <dd>Base 64 encoded binary data of icon.</dd>
                <dt>icon_mime</dt>
                <dd>
                  <p>MIME type of the icon. Usually, <code>image/png</code> or <code>image/jpeg</code>.</p>
                </dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 385,&#x000A;  &quot;name&quot;: &quot;Soutaro Matsumoto&quot;,&#x000A;  &quot;enabled&quot;: true,&#x000A;  &quot;icon&quot;: $base64Encoded,&#x000A;  &quot;icon_mime&quot;: &quot;image/png&quot;,&#x000A;}</pre>
            </div>
          </div>
          <h2>Friend</h2>
          <p>Account summary information for chain branches.</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of account.</dd>
                <dt>name</dt>
                <dd>Name of the account.</dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  id: 199,&#x000A;  name: &quot;hogehoge&quot;,&#x000A;}</pre>
            </div>
          </div>
          <h2>Menu Item</h2>
          <p>Item in menus, which represents one product/service you sell.</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of the object.</dd>
                <dt>sku</dt>
                <dd>SKU of the item.</dd>
                <dt>name</dt>
                <dd>Name of the item.</dd>
                <dt>price</dt>
                <dd>Price of the item. Note that price is a string to avoid inacculate compuation using floats.</dd>
                <dt>price_type</dt>
                <dd>
                  <p>Note on price. One of <code>intax</code>, <code>outtax</code>, <code>percent</code>, and <code>nosales</code>.
                  <code>intax</code> is used for normal items, such that the VAT is included in the price.
                  <code>outtax</code> is to mark that the VAT is not included in the price.
                  <code>percent</code> is for discounting/premiums.
                  If "20" is the price of the item and the price_type is <code>percent</code>, The price is <em>20% of premiour</em>.
                  <code>nosales</code> is mark that the total sales with this item is not included in sales.</p>
                </dd>
                <dt>vat</dt>
                <dd>
                  <p>Percentage of VAT. Present if <code>price_type</code> is <code>intax</code> or <code>outtax</code>.</p>
                </dd>
                <dt>position</dt>
                <dd>
                  <p>Position of the item in its category. <code>null</code> if the item is disabled.</p>
                </dd>
                <dt>category_id</dt>
                <dd>
                  <p>The category the item is belonging to. <code>null</code> if the item is disabled.</p>
                </dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 271,&#x000A;  &quot;sku&quot;: &quot;sku&quot;,&#x000A;  &quot;name&quot;: &quot;Coke&quot;,&#x000A;  &quot;price&quot;: &quot;105&quot;,&#x000A;  &quot;price_type&quot;: intax,&#x000A;  &quot;vat&quot;: 5,&#x000A;  &quot;position&quot;: 102,&#x000A;  &quot;category_id&quot;: 105,&#x000A;}</pre>
            </div>
          </div>
          <h2>Category</h2>
          <p>Categories are used to organize items in a menu. Categories can not be nested.</p>
          <div class='row'>
            <div class='span8'>
              <h3>Fields</h3>
              <dl>
                <dt>id</dt>
                <dd>ID of the object.</dd>
                <dt>name</dt>
                <dd>Name of the category.</dd>
                <dt>position</dt>
                <dd>
                  <p>Position of the category in menu. <code>null</code> if the category is disabled.</p>
                </dd>
              </dl>
            </div>
            <div class='span8'>
              <h3>Example</h3>
              <pre>{&#x000A;  &quot;id&quot;: 18,&#x000A;  &quot;name&quot;: &quot;Soft Drink&quot;,&#x000A;  &quot;position&quot;: 4,&#x000A;}</pre>
            </div>
          </div>
        </div>
        <div class='tab-pane' id='resources'>
          <h2>/account</h2>
          <p>
            The user's account. Readonly.
          </p>
          <h3>GET /account</h3>
          <p>Download the information of current account.</p>
          <div class='row'>
            <div class='span8'>
              <pre>{&#x000A;  &quot;account&quot;: $account,&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;}</pre>
            </div>
            <div class='span8'>
              <dl>
                <dt>account</dt>
                <dd>The account.</dd>
                <dt>timestamp</dt>
                <dd>The time in ubiregi.com server.</dd>
              </dl>
            </div>
          </div>
          <h3>Note</h3>
          <p>Accesses to <code>/account</code> do not expire.
          Even if your account is expired, it returns your account's information.
          However menus, stocks, tables, customer_tags, and cashiers will be empty in that case.</p>
          <h2>/cashiers</h2>
          <p>Collection of cashiers defined in the user's account.</p>
          <h3>GET on /cashiers</h3>
          <h3>POST on /cashiers</h3>
          <h2>/customer_tags</h2>
          <p>Collection of customer tags defined in the account.</p>
          <h3>GET on /customer_tags</h3>
          <h3>POST on /customer_tags</h3>
          <h2>/payment_types</h2>
          <p>Collection of payment methods defined in the account.</p>
          <h3>GET on /payment_types</h3>
          <h3>POST on /payment_types</h3>
          <h2>/tables</h2>
          <p>Collection of tables defined in the account.</p>
          
          <p>Tables objects are to be obsolete, and there are no update operations for <code>/tables</code>.</p>
          <h3>GET on /tables for indexing</h3>
          <h2>/menus/:id/items</h2>
          <p>Collection of items in menu specified by <code>:id</code>.</p>
          <h3>GET on /menus/:id/items</h3>
          <h3>POST on /menus/:id/items</h3>
          <h2>/menus/:id/categories</h2>
          <p>Collection of categories in menu specified by <code>id</code>.</p>
          <h3>GET on /menus/:id/categories</h3>
          <h3>POST on /menus/:id/categories</h3>
          <h3>POST on /menus/categories/:id/delete (for deletion)</h3>
          <h2>/checkouts</h2>
          <p>Collection of checkouts of the account.</p>
          <h3>GET on /checkouts</h3>
          <h3>POST on /checkouts</h3>
          <h3>GET on /checkouts/:id (for fetching other account's checkout)</h3>
          <h2>/customers</h2>
          <p>Collection of customers available for the account.</p>
          <h3>GET on /customers</h3>
          <h3>POST on /customers</h3>
          <h2>/customers/notes</h2>
          <p>Collection of customer notes associated with <code>/customers</code>.</p>
          <h3>GET on /customers/notes</h3>
          <h3>POST on /customers/:id/notes</h3>
          <h2>/stocks/events</h2>
          <p>Collection of stocking events of the account.</p>
          <h3>GET on /stocks/events</h3>
          <h3>POST on /stocks/events</h3>
        </div>
      </div>
      <script type='text/javascript'>
        //<![CDATA[
          $('.tabs').tabs()
        //]]>
      </script>
      <hr />
      <div class='row' style='text-align:center; margin-bottom:2em'>
        &copy; 2011 Ubiregi Inc. All rights reserved.
      </div>
    </div>
  </body>
</html>
