<html>
  <head>
    <title>Ubiregi API (Beta)</title>
    <meta charset='utf-8' />
    <link href='bootstrap.min.css' rel='stylesheet' />
    <link href='top.css' rel='stylesheet' />
    <meta content='width=1120' name='viewport' />
  </head>
  <body>
    <div class='menu span5'>
      <div style='padding:10px'>
        <h1>Ubiregi API</h1>
        <h3><a href='#introduction'>Introduction</a></h3>
        <ul>
          <li><a href='#introduction-implementation-status'>Implementation Status</a></li>
          <li><a href='#introduction-quick-start'>Quick Start</a></li>
          <li><a href='#introduction-examples'>Examples</a></li>
          <li><a href='#introduction-general-notes'>Note</a></li>
        </ul>
        <hr />
        <h3><a href='#authentication'>Authentication</a></h3>
        <ul>
          <li><a href='#authentication-app-registration'>App Registration</a></li>
          <li><a href='#authentication-authorization'>Getting Authorized</a></li>
          <li><a href='#authentication-token'>Working with Token</a></li>
          <li><a href='#authentication-api-access'>Accessing API with Token</a></li>
          <li><a href='#authentication-compat'>Old API Compatiblity</a></li>
        </ul>
        <hr />
        <h3>API Objects</h3>
        <h4><a href='#notations'>Notations</a></h4>
        <h4><a href='#collection-api-set'>Collection API</a></h4>
        <h4><a href='#object-account'>Account</a></h4>
        <ul>
          <li><a href='#object-account-fields'>Fields</a></li>
          <li><a href='#get-on-accounts-account-id'>GET on /accounts/<em>account_id</em></a></li>
        </ul>
        <h4><a href='#object-table'>Table</a></h4>
        <ul>
          <li><a href='#object-table-fields'>Fields</a></li>
        </ul>
        <h4><a href='#object-customer-tag'>CustomerTag</a></h4>
        <ul>
          <li><a href='#object-customer-tag-fields'>Fields</a></li>
          <li><a href='#post-on-accounts-account-id-customer-tags'>POST on /accounts/<em>account_id</em>/customer_tags</a></li>
        </ul>
        <h4><a href='#object-cashier'>Cashier</a></h4>
        <ul>
          <li><a href='#object-cashier-fields'>Fields</a></li>
          <li><a href='#post-on-accounts-account-id-cashiers'>POST on /accounts/<em>account_id</em>/cashiers</a></li>
        </ul>
        <h4><a href='#object-payment-type'>PaymentType</a></h4>
        <ul>
          <li><a href='#object-payment-type-fields'>Fields</a></li>
          <li><a href='#post-on-accounts-account-id-payment-types'>POST on /accounts/<em>account_id</em>/payment_types</a></li>
        </ul>
        <h4><a href='#object-menu-item'>MenuItem</a></h4>
        <ul>
          <li><a href='#object-menu-item-fields'>Fields</a></li>
          <li><a href='#get-on-menus-menu-id-items'>GET on /menus/<em>menu_id</em>/items</a></li>
          <li><a href='#post-on-menus-menu-id-items'>POST on /menus/<em>menu_id</em>/items</a></li>
        </ul>
        <h4><a href='#object-category'>Categry</a></h4>
        <ul>
          <li><a href='#object-category-fields'>Fields</a></li>
          <li><a href='#get-on-menus-menu-id-categories'>GET on /menus/<em>menu_id</em>/categories</a></li>
          <li><a href='#post-on-menus-menu-id-categories'>POST on /menus/<em>menu_id</em>/categories</a></li>
        </ul>
        <h4><a href='#object-stock-event'>StockEvent</a></h4>
        <ul>
          <li><a href='#object-stock-event-fields'>Fields</a></li>
          <li><a href='#get-on-accounts-account-id-stocks-events'>GET on /accounts/<em>account_id</em>/stocks/events</a></li>
          <li><a href='#post-on-accounts-account-id-stocks-events'>POST on /accounts/<em>account_id</em>/stocks/events</a></li>
        </ul>
        <h4><a href='#object-checkout'>Checkout</a></h4>
        <ul>
          <li><a href='#object-checkout-fields'>Fields</a></li>
          <li><a href='#get-on-accounts-account-id-checkouts'>GET on /accounts/<em>account_id</em>/checkouts</a></li>
          <li><a href='#get-on-accounts-account-id-checkouts-close'>GET on /accounts/<em>account_id</em>/checkouts/close</a></li>
          <li><a href='#post-on-accounts-account-id-checkouts'>POST on /accounts/<em>account_id</em>/checkouts</a></li>
        </ul>
        <h4><a href='#object-checkout-item'>CheckoutItem</a></h4>
        <ul>
          <li><a href='#object-checkout-item-fields'>Fields</a></li>
        </ul>
        <h4><a href='#object-checkout-payment'>CheckoutPayment</a></h4>
        <ul>
          <li><a href='#object-checkout-payment-fields'>Fields</a></li>
        </ul>
        <h4><a href='#object-customer'>Customer</a></h4>
        <ul>
          <li><a href='#object-customer-fields'>Fields</a></li>
          <li><a href='#get-on-customers'>GET on /customers</a></li>
          <li><a href='#post-on-customers'>POST on /customers</a></li>
        </ul>
        <h4><a href='#object-customer-field'>CustomerField</a></h4>
        <ul>
          <li><a href='#object-customer-field-fields'>Fields</a></li>
        </ul>
        <h4><a href='#object-customer-note'>CustomerNote</a></h4>
        <ul>
          <li><a href='#object-customer-note-fields'>Fields</a></li>
          <li><a href='#get-on-customers-notes'>GET on /customers/notes</a></li>
          <li><a href='#post-on-customers-notes'>POST on /customers/notes</a></li>
        </ul>
        <h4><a href='#api-notes'>API Notes</a></h4>
        <h3><a href='#errors'>Errors</a></h3>
        <ul>
          <li><a href='#errors-status-code'>Status code</a></li>
          <li><a href='#errors-error-object'>Error object</a></li>
        </ul>
        <hr />
        <div class='row' style='text-align:center; margin-bottom:2em'>
          &copy; 2011 Ubiregi Inc. All rights reserved.
        </div>
      </div>
    </div>
    <div class='container'>
      <div class='row'>
        <div class='span12 offset4'>
          <div class='title'>
            <h1>Ubiregi API</h1>
            <div>
              Ubiregi is simple and clean yet powerful; so the API is.
            </div>
          </div>
          <p>
  Ubiregi API is currently <strong>beta version</strong>.  There are <strong>no guarantees</strong> to use it.  Behaviors of the API
  maybe <strong>changed or fixed without notice</strong>.
</p>
<h1 id='introduction'>Introduction</h1>
<p>
  Ubiregi API allows third parties to develop systems which interact
  with Ubiregi data, including menus, tags, customers, and checkouts.
</p>
<p>
  Using Ubiregi API, you can develop your own application for:
</p>
<ul>
  <li>Editing menus with your <s>legacy</s> excellent system</li>
  <li>Importing sales data into your <s>legacy</s> great system</li>
  <li>Advanced sales analysis</li>
  <li>Advanced stock control</li>
  <li>Booking</li>
</ul>
<p>
  and, such features essential for your or your clients' business.
</p>
<p>
  Ubiregi API provides almost full access to Ubiregi's data. Everything
  except authentication is the same with what the Ubiregi app is doing.
  (In fact, the API v3 is essentially more powerful than API v2, which is
  used by Ubiregi 2.x)
</p>
<h2 id='introduction-quick-start'>Quick Start</h2>
<ol>
  <li>Sign-up to ubiregi.com</li>
  <li>Register for developer account and new application</li>
  <li>Install the application on your account</li>
  <li>Download the examples.</li>
  <li>Change the sample app, and it is your app now!</li>
</ol>
<h2 id='introduction-general-notes'>
  General Notes
  <small>Things every developer should know</small>
</h2>
<h4>Github project</h4>
<p>
  We have <a href='https://github.com/ubiregiinc/ubiregi-api'>github project</a> to communicate with Ubiregi API users.
  It has an issue tracker, and we are using it.
</p>
<p>
  <span class='label warning'>Note</span>
  All issues, but security related ones, are expected to be reported on the tracker.
  Think twice before you send me an email to report an issue.
</p>
<h4>The API is Entirely HTTP-based, and Almost RESTful</h4>
<p>
  Methods to retrieve data from the Ubiregi API requires a GET
  request. Methods to create new things requires a POST request. And to
  update things requires a PUT request. Most methods requires a
  particular HTTP method and will return an error if you do not make your
  request with the correct one.
</p>
<p>
  The API is almost RESTful.
  Every operations are update of attributes of resources.
</p>
<h4>Ubiregi Web App is Built on Rails</h4>
<p>
  We use Ruby on Rails 3 to develop ubiregi.com web app. You may find
  something odd our api. It should be because of Rails requirements.
</p>
<p>
  We carefully described things non-rails-developer should mention
  about, but may be insufficient. If you have some problem, you may
  need to check Rails related documents.
</p>
<h4>JSON is Used</h4>
<p>
  We use JSON for every structured data. It implies that binary data are
  encoded with base64 and non-ascii characters are UTF8 encoded.
</p>
<p>
  POST request should be send with HTTP header <code>Content-Type: application/json</code>.
</p>
<h4>Use HTTPS</h4>
<p>
  All requests to Ubiregi API must be HTTPS requests.
</p>
<h2 id='introduction-examples'>Examples</h2>
<dl>
  <dt><a href='https://github.com/ubiregiinc/ubiregi-api-client-scala'>Ubiregi-API-Client for Scala</a></dt>
  <dd>
    Simple library which abstracts API calls and authentications, for Scala.
  </dd>
</dl>
          <hr />
          <h1 id='authentication'>Authentication</h1>
<p>
  Ubiregi API access is managed in the OAuth2 manner.
  You should consult to OAuth2 spec for details.
</p>
<h2 id='authentication-app-registration'>App Registration</h2>
<p>Visit <a href="https://ubiregi.com/developer">Ubiregi Developer Dashboard</a> to
register your app.</p>
<h3>Remarks</h3>
<ul>
<li>Ubiregi apps are not necessary to have an <code>https</code> redirect URI
(<code>http</code> can be used; although it is not recommended.)</li>
<li>Ubiregi apps can not have multiple redirect URIs</li>
<li><em>Public client</em> means the app does not have an credential to be authenticated.
The publicity can not be changed later.</li>
</ul>
<h2 id='authentication-authorization'>Getting Authorized</h2>
<p>
  Make your user's UA to access at <code>https://ubiregi.com/oauth2/authorize</code> endpoint.
  The endpoint accepts several query parameters.
</p>
<table>
  <tr>
    <th>client_id</th>
    <td>Your client's ID (OAuth2)</td>
  </tr>
  <tr>
    <th>state</th>
    <td>To pass a parameter to your callback. (OAuth2)</td>
  </tr>
  <tr>
    <th>force_login</th>
    <td>
      Give true if you want your user to input their username and password.
      (Default: false)
    </td>
  </tr>
  <tr>
    <th>force_authrize</th>
    <td>
      Give true if you want your user to click "Authorize" button before your app got authorized.
      (Default: false; if your user is trying to authorize your app again, it skips to prompt "Authorize" button.)
    </td>
  </tr>
  <tr>
    <th>mobile</th>
    <td>
      Give true if your user's UA is mobile device (small screen).
      (Default: false)
    </td>
  </tr>
</table>
<h2 id='authentication-token'>Working with Token</h2>
<p>
  <code>https://ubiregi.com/oauth2/token</code> is the token endpoint.
  POST HTTP request following OAuth2 protocol to:
</p>
<ul>
  <li>Obtain an Access Token using Access Grant</li>
  <li>Refresh Access Token using Refresh Token</li>
</ul>
<h3>Token Response</h3>
<p>
  The token endpoint access response is a JSON object like the following.
</p>
<pre>{&#x000A;  &quot;access_token&quot;: $token,&#x000A;  &quot;token_type&quot;: &quot;bearer&quot;,&#x000A;  &quot;expires_in&quot;: $seconds,&#x000A;  &quot;refresh_token&quot;: $token,&#x000A;  &quot;refresh_token_expires_in&quot;: $seconds,&#x000A;  &quot;account_id&quot;: $account_id&#x000A;}</pre>
<p>
  Most fields are ones of OAuth2, but <code>refresh_token_expires_in</code> and <code>account_id</code> are extension by Ubiregi API.
</p>
<dl>
  <dt>access_token</dt>
  <dd>Access token.</dd>
  <dt>token_type</dt>
  <dd>Always <code>bearer</code>.</dd>
  <dt>expires_in</dt>
  <dd>Seconds remain to access token expiration.</dd>
  <dt>refresh_token</dt>
  <dd>Refresh token.</dd>
  <dt>refresh_token_expires_in</dt>
  <dd>
    Seconds remain to refresh token expiration.
    This is an extension by Ubiregi API.
  </dd>
  <dt>account_id</dt>
  <dd>
    ID of the account which authenticated with the token.
    This is an extension by Ubiregi API.
  </dd>
</dl>
<p>
  Access token and refresh token will expire.
  Access token expiration is in 24 hours, and refresh token expiration is in 14 days in current implementation.
  This is just because of implementation.
  We may change them.
</p>
<h3>Obtaining Access Token</h3>
<p>
  POST a request with <code>grant_type=authorization_code</code> to obtain an access_token.
  This is standard OAuth2 request and other parameters specified by OAuth2 will be accepted.
</p>
<p>
  Ubiregi API issues new access token for each <code>authorization_code</code> request.
  This might be annoying to your client since one account may have many access tokens.
  <code>account_id</code> field is a remedy to this.
  Invalidate all access tokens associated with the <code>account_id</code> already issued and stored in your database, and you can keep your DB clean.
</p>
<h3>Refreshing Access Token</h3>
<p>
  POST a request with <code>grant_type=refresh_token</code> to refresh an access_token.
  This is standard OAuth2 request and other parameters specified by OAuth2 will be accepted.
</p>
<p>
  It is completely okay if you refresh your token even if it is not expired.
  It invalidates the old access token, and issues new access token and refresh token pair.
</p>
<h2 id='authentication-api-access'>Accessing API with Token</h2>
<p>
  Give an <code>Authorization</code> HTTP request header in the following syntax.
</p>
<pre>Authorization: Bearer 2948or823934y8w9dfit834</pre>
<p>
  If the token is invalid, the request will result in <code>401</code> and <code>WWW-Authenticate</code> header will be <code>Bearer error="invalid_token"</code>.
</p>
<p>
  If the token is expired, the request will result in <code>401</code> and <code>WWW-Authenticate</code> header will be <code>Bearer error="invalid_token",expired=true</code>.
  The <code>expired</code> field will be given to mark the client should refresh access token using refresh token. This is an extension of OAuth2 by Ubiregi API.
</p>
<h2 id='authentication-compat'>Old API Compatibility</h2>
<p>
  Ubiregi API was using an token based simple access control.
  Currently, new app registration form is closed for this protocol.
  However, existing apps can be used to access the API.
</p>
<p>Give all HTTP requests to the API the following headers.</p>
<table>
  <tr>
    <th width='190'><code>X-Ubiregi-Auth-Token</code></th>
    <td>
      The authentication token of the user for your app installation.
      This is used for authentication.
    </td>
  </tr>
  <tr>
    <th><code>X-Ubiregi-App-Secret</code></th>
    <td>
      <div>
        Hash of your app's secret.
        This is used to identify which app send the access, and can be used to block the app.
        You are responsible to keep it secret.
      </div>
      <div>
        Given your app's <em>secret</em> and your generated <em>salt</em>, compute
      </div>
      <blockquote>
        <em>salt</em><code>:</code><em>h(salt . secret)</em>
      </blockquote>
      <div>
        where, <em>h</em> is SHA1 hashing function, and <em>.</em> is concatenation of two strings.
      </div>
    </td>
  </tr>
</table>
<p>
  If <code>X-Ubiregi-Auth-Token</code> or <code>X-Ubiregi-App-Secret</code> is invalid, your request will result in <code>401</code> (Unauthorized) status.
</p>
<p>
  Check the <a href='#introduction-examples'>examples</a> to see how the authentication is exactly.
</p>
<h2>Account Expiration</h2>
Account may be expired.
<dl>
  <dt>Expired account at time <em>t</em></dt>
  <dd>
    If an account does not have valid subscription at time <em>t</em>, the account is <em>expired</em>.
  </dd>
  <dt>Visible checkouts</dt>
  <dd>
    Checkouts which can be downloaded from ubiregi.com server.
    The computation of monthly sales and so on only takes visible checkouts as their input.
  </dd>
  <dt>Invisible checkouts</dt>
  <dd>
    Checkouts which can not be downloaded from ubiregi.com server.
    Invisible checkouts will be ignored, but they are stored on ubiregi.com server.
  </dd>
  <dt>Expired checkout at time <em>t</em></dt>
  <dd>
    Checkouts, where its account is expired at its <code>paid_at</code> and closed.
  </dd>
</dl>
<ul>
  <li>Expired checkout at time <em>t</em> is invisible.</li>
  <li>Checkouts where its <code>paid_at</code> is less than 3 days (72 hours) ago from <em>t</em> is visible, even if they are expired.</li>
</ul>
<p>The definition of checkout visibility is described in the following figure.
Green and gray dots are visible and invisible checkouts respectively (assume all checkouts are closed).
Group of visible checkouts in left is because the existence of a subscription.
Another group of visible checkouts in right is because its <code>paid_at</code> is new.</p>
<img src='images/checkout-visibility.png'>
<p>These definitions about checkout visibility may cause a problem, when your user's account is expired and your user is using CRM.
Customer's history may have a reference to invisible checkouts.</p>
          <hr />
          <h1 id='notations'>Notations</h1>
<h2>Field Attributes</h2>
<p>The field definition may have following attributes:</p>
<span class='label readonly'>readonly</span>
<p>Calculation of the value of the field is a task of server.
Client can not set the value.</p>
<span class='label writeonly'>writeonly</span>
<p>The server never send the value of the attribute.</p>
<span class='label immutable'>immutable</span>
<p>The client may post the value on creating a object,
but it can not update the value once the object is created.</p>
<h2>Meta Variables</h2>
<p>We use the following meta variables in the JSON examples.</p>
<dl>
  <dt>$<em>type</em></dt>
  <dd>Object of <em>type</em>.</dd>
  <dt>$<em>type</em><code>s</code></dt>
  <dd>
    Sequence of objects of <em>type</em>.
    Usually contents of an array.
  </dd>
  <dt>$base64Encoded</dt>
  <dd>Base64 encoded string of a binary data.</dd>
  <dt>$UUID-like-sequence</dt>
  <dd>
    String which is expected to be unique in the world.
    It is UUID in the case the sequence is generated in server.
    If it is generated by iOS, it is not an exact UUID but an extended one by Apple.
  </dd>
  <dt>$Time</dt>
  <dd>ISO8601 format string of a time.</dd>
</dl>
          <h1 id='collection-api-set'>Standard Set of APIs on Collections</h1>
<p>
  Most resource collections provides the following set of APIs.
</p>
<ul>
  <li>Retrieving the collection (Index)</li>
  <li>Creating or updating items (POST)</li>
  <li><span class="label success">Optional</span> Retrieving one item (GET)</li>
</ul>
<h2>Standard Index Parameters</h2>
<p>
  Indexing actions take a set of parameters; <code>since</code>, <code>until</code>, and <code>glb</code>.
  They are used to limit the size of the result sets.
</p>
<table>
  <tr>
    <th><code>since</code></th>
    <td>Limits the result set to contain only updated items since the parameter.</td>
  </tr>
  <tr>
    <th><code>until</code></th>
    <td>Limits the result set to reject items updated since the parameter.</td>
  </tr>
  <tr>
    <th><code>glb</code></th>
    <td>Greatest lower bound of id of the result set. This is used to retrieve next batch of the collection.</td>
  </tr>
</table>
<p>The result set can be described as follows:</p>
<blockquote>{ item | since ≤ item.updated_at ⋀ item.updated_at < until ⋀ glb < item.id }</blockquote>
<p>The items are sorted by their <code>id</code>s.</p>
<p>The result will be on following pattern.</p>
<pre>{&#x000A;  &quot;timestamp&quot;: timestamp,&#x000A;  &quot;next-url&quot;: url,&#x000A;  &quot;last_updated_at&quot;: timestamp,&#x000A;  rows: [ objects ],&#x000A;}</pre>
<dl>
  <dt>timestamp</dt>
  <dd>
    <p>The server time.
    This is sent for the case client local clock is incorrect.
    If <code>until</code> parameter is specified, <code>timestamp</code> will be the requested <code>until</code>.</p>
  </dd>
  <dt>next-url</dt>
  <dd>
    The URL to retrieve next result set.
    This will be unspecified in the case there are no more results.
  </dd>
  <dt>last_updated_at</dt>
  <dd>
    The timestamp on the time, there were last update of an object which belongs to the resource you requested.
  </dd>
  <dt>$rows</dt>
  <dd>
    <p>Array of objects.
    The name will be different, <code>items</code> for MenuItems, <code>categories</code> for Categories, and <code>checkouts</code> for Checkouts.</p>
  </dd>
</dl>
<h2>Fetching Whole Collection</h2>
<p>There are limitation on the number of objects contained in one request; this is the reason we accept <code>glb</code> parameter.
You might have a question that how to get the whole collection?
A set of requests to fetch collections can be interleaved by requests which updates objects which is contained in the collection.
In that case, the <code>updated_at</code> field will be updated and because of the <code>until</code> parameter included in the fetch request, the updated objects can not be fetched.</p>
<p><code>last-updated-at</code> field is to handle such case.
If there are no <code>next-url</code> field sent, which means there are no more object for the parameters you specified, check if the <code>timestamp</code> field is newer than <code>last-updated-at</code>.</p>
<ol>
<li>Send a request without <code>until</code> and <code>glb</code> parameters.</li>
<li>Check if the response contains <code>next-url</code> field.</li>
<li>If contains, fetch the <code>next-url</code> and go step 2 again.</li>
<li>If not contains, send a request again but with <code>since</code> = <code>timestamp</code>, and go step 2 again.</li>
</ol>
<h2>POST Convention</h2>
<p>
  POST actions to collection create or update more than one items.
  This helps to make updating many items faster.
</p>
<p>
  The request will be like the following:
</p>
<pre>[&#x000A;  { &quot;name&quot;: &quot;new object&quot;, ... },&#x000A;  { &quot;name&quot;: &quot;another new object&quot;, ...},&#x000A;  { &quot;id&quot;: 123, &quot;name&quot;: &quot;object to be updated&quot; },&#x000A;]</pre>
<ul>
<li>If there are no <code>id</code> field in an object, it will create new item.</li>
<li>If there are <code>id</code> field in an object, it will update an existing item.</li>
</ul>
<p>The post action is transactional.
If there are an error processing an item, all creation or update of items will be canceled.
There will be one of <em>everything ok</em> or <em>nothing changed</em>.</p>
<p>There is no limitation on number of objects in one request, but you should take care of it.
100 items in a request will be ok. 10,000 items in a request should cause a problem.
We will ask you to stop posting too big request, if there are some problem.</p>
          <h1 id='object-account'>Account</h1>
<p><code>Account</code> object represents an Ubiregi account.
This is one of the most fat object such that it has most related data with the account including tables, cashiers, payment types.
Fetching an <code>Account</code> object should be the entry point for most API clients.</p>

<p><code>Account</code> objects are readonly. There are no API to update.</p>
<h2 id='object-account-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>Account ID.</dd>
      <dt>login</dt>
      <dd>Account's login</dd>
      <dt>email</dt>
      <dd>Account's email</dd>
      <dt>name</dt>
      <dd>Account name to be displayed to users.</dd>
      <dt>expire_at</dt>
      <dd>
        Expiration data.
        May be `null` in the case there is no expiration on subscription.
      </dd>
      <dt>currency</dt>
      <dd>One of <code>"JPY"</code>, <code>"USD"</code>, <code>"Unknown 2"</code>, and <code>"Unknown 3"</code>.</dd>
      <dt>date_offset</dt>
      <dd>
        The hour date changes.
        If this is <code>6</code>, the date changes at 6 AM, ie <code>2012-01-01T05:59:00Z</code> is December 31, 2011 (If the timezone is UTC).
      </dd>
      <dt>timezone</dt>
      <dd>Timezone.</dd>
      <dt>receipt_title</dt>
      <dd>Receipt title.</dd>
      <dt>receipt_footer</dt>
      <dd>Footer text to be printed on receipt.</dd>
      <dt>receipt_logo</dt>
      <dd>Base64 encoded logo image to be printed on receipt.</dd>
      <dt>menus</dt>
      <dd>Array of IDs of <code>Menu</code>.</dd>
      <dt>tables</dt>
      <dd>Array of <code>Table</code>s.</dd>
      <dt>customer_tags</dt>
      <dd>Array of <code>CustomerTag</code>s.</dd>
      <dt>payment_types</dt>
      <dd>Array of <code>PaymentType</code>s.</dd>
      <dt>cashiers</dt>
      <dd>Array of <code>Cashier</code>s.</dd>
      <dt>parent_ids</dt>
      <dd>Array of IDs of parent accounts.</dd>
      <dt>child_ids</dt>
      <dd>Array of IDs of child accounts.</dd>
      <dt>sibling_ids</dt>
      <dd>Array of IDs of sibling accounts.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 123,&#x000A;  &quot;created_at&quot;: &quot;2011-12-31:00:00:31Z&quot;,&#x000A;  &quot;updated_at&quot;: &quot;2012-01-30:00:30:11Z&quot;,&#x000A;  &quot;login&quot;: &quot;ubiregi-cafe&quot;,&#x000A;  &quot;email&quot;: &quot;cafe@ubiregi.com&quot;,&#x000A;  &quot;name&quot;: &quot;Ubiregi Cafe&quot;,&#x000A;  &quot;expire_at&quot;: &quot;2011-11-13T00:00:00Z&quot;,&#x000A;  &quot;subscription&quot;: &quot;standard&quot;,&#x000A;  &quot;currency&quot;: &quot;JPY&quot;,&#x000A;  &quot;date_offset&quot;: 6,&#x000A;  &quot;timezone&quot;: &quot;Asia/Tokyo&quot;,&#x000A;  &quot;receipt_title&quot;: &quot;RECEIPT&quot;,&#x000A;  &quot;receipt_footer&quot;: &quot;Footer to be printed in receipts&quot;,&#x000A;  &quot;receipt_logo&quot;: $base64Encoded,&#x000A;  &quot;menus&quot;: [ 8 ],&#x000A;  &quot;tables&quot;: [ $tables ],&#x000A;  &quot;customer_tags&quot;: [ $customer_tags ],&#x000A;  &quot;payment_types&quot;: [ $payment_types ],&#x000A;  &quot;cashiers&quot;: [ $cashiers ],&#x000A;  &quot;parent_ids&quot;: [ 100 ],&#x000A;  &quot;child_ids&quot;: [ 200, 124 ],&#x000A;  &quot;sibling_ids&quot;: [ 100, 2031, 581 ],&#x000A;}</pre>
  </div>
</div>
<h2 id='get-on-accounts-account-id'>GET on /accounts/<em>account_id</em></h2>
<p>Retrieves an <code>Account</code> object with <em>account_id</em>.</p>

<p><em>account_id</em> can be either the ID of account or an string <code>"current"</code>.
If <code>"current"</code> is specified, it is understood as the ID of current account.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /accounts/133&#x000A;GET /accounts/current</pre>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;account&quot;: $account,&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>account</dt>
      <dd>The account.</dd>
      <dt>timestamp</dt>
      <dd>The time in ubiregi.com server.</dd>
    </dl>
  </div>
</div>
<h3>Note</h3>
<p>The access is only allowed to current, parent, and child accounts.
In other case, your request will result in 404 (not found) error.</p>
          <h1 id='object-table'>Table</h1>
<p><strong><code>Table</code> object is deprecated.</strong>
It is working now but will be obsoleted soon.</p>

<p><code>Table</code> objects represent tables.
Table is special mark for restaurants tables.
However, it will be deprecated soon.
Using <code>CustomerTag</code> instead of <code>Table</code> is encouraged.</p>

<p>Since it will soon be deprecated, there are no API to update.
The only way to edit <code>Table</code> is logging in to the Ubiregi web app.</p>

<p>Retrieving <code>Table</code>s can be done through <code>Account</code> objects.</p>
<h2 id='object-table-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>name</dt>
      <dd>Name of the table.</dd>
      <dt>position</dt>
      <dd>
        An integer which represents the position of the table.
        The interpretation depends on the client applications.
        <code>position</code> will be <code>null</code> if the <code>Table</code> is disabled.
      </dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 123,&#x000A;  &quot;name&quot;: &quot;Table 1&quot;,&#x000A;  &quot;position&quot;: 3,&#x000A;}</pre>
  </div>
</div>
          <h1 id='object-customer-tag'>CustomerTag</h1>
<p>Tags to give various information on checkouts.
This can be used to record that <em>the customer is 20th girl</em>, <em>they came for dating</em>, and so on.</p>
<h2 id='object-customer-tag-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>name</dt>
      <dd>Name of the tag.</dd>
      <dt>position</dt>
      <dd>
        Position of the tag. <code>null</code> in the case the tag is inactive.
        The interpretation depends on client, however the value should be from 1 to 12.
        There is no validation on ubiregi.com server on the uniqueness of <code>position</code>.
      </dd>
      <dt>icon_name <span class='label writeonly'>Writeonly</span></dt>
      <dd>Name of icon.</dd>
      <dt>icon <span class='label readonly'>Readonly</span></dt>
      <dd>Icon image for the tag.</dd>
      <dt>icon_mime <span class='label readonly'>Readonly</span></dt>
      <dd>MIME type of the icon. Usually <code>image/png</code>.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 123,&#x000A;  &quot;name&quot;: &quot;Dating&quot;,&#x000A;  &quot;position&quot;: null,&#x000A;  &quot;icon&quot;: $base64Encoded,&#x000A;  &quot;icon_mime&quot;: &quot;image/png&quot;,&#x000A;}</pre>
  </div>
</div>
<h3>Setting an Icon</h3>
<p>Icons can be set through <code>icon_name</code> attribute.
The value of <code>icon_name</code> should be one of the following list.</p>

<p><strong><em> FIXME </em></strong></p>

<p>Icons are sent from server as its binary image in Base64 encoded form.</p>

<p>Thus, <code>icon_name</code> is a <em>writeonly</em> attribute and <code>icon</code> and <code>icon_mime</code> are <em>readonly</em> attributes.</p>
<h2 id='post-on-accounts-account-id-customer-tags'>POST on /accounts/<em>account_id</em>/customer_tags</h2>
<p>Update the customer_tags of an account specified by <em>account_id</em>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;customer_tags&quot;: [&#x000A;    {&#x000A;      &quot;name&quot;: &quot;Dating&quot;,&#x000A;      &quot;position&quot;: 10,&#x000A;      &quot;icon_name&quot;: &quot;F1&quot;,&#x000A;    },&#x000A;    {&#x000A;      &quot;id&quot;: 31,&#x000A;      &quot;position&quot;: null,&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>customer_tags</dt>
      <dd>
        Collection of <code>CustomerTag</code> objects.
        <dl>
          <dt>id</dt>
          <dt>name</dt>
          <dt>position</dt>
          <dt>icon_name</dt>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:12Z&quot;,&#x000A;  &quot;customer_tags&quot; : $customer_tags&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>customer_tags</dt>
      <dd>
        Collection of updated/created customer tags.
        Client app should refresh account information to make sure there are no more <code>CustomerTag</code>s defined.
      </dd>
    </dl>
  </div>
</div>
          <h1 id='object-cashier'>Cashier</h1>
<p><code>Cashier</code> object represents the person who operated the cash register.</p>
<h2 id='object-cashier-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>name</dt>
      <dd>Name of the cashier.</dd>
      <dt>enabled</dt>
      <dd><code>true</code> if the cashier is enabled. <code>false</code> if the cashier is disabled.</dd>
      <dt>icon</dt>
      <dd>Base64 encoded binary data of icon.</dd>
      <dt>icon_mime <span class='label readonly'>Readonly</span></dt>
      <dd>MIME type of the icon. Usually, <code>"image/png"</code> or <code>"image/jpeg"</code>.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 385,&#x000A;  &quot;name&quot;: &quot;Soutaro Matsumoto&quot;,&#x000A;  &quot;enabled&quot;: true,&#x000A;  &quot;icon&quot;: $base64Encoded,&#x000A;  &quot;icon_mime&quot;: &quot;image/png&quot;,&#x000A;}</pre>
  </div>
</div>
<h2 id='post-on-accounts-account-id-cashiers'>POST on /accounts/<em>account_id</em>/cashiers</h2>
<p>Update the cashiers of an account specified by <em>:account_id</em>.
The child account's cashiers can be updated by parents.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;cashiers&quot;: [&#x000A;    {&#x000A;      &quot;name&quot;: &quot;New cashier&quot;,&#x000A;      &quot;enabled&quot;:true,&#x000A;      &quot;icon&quot;:$base64Encoded,&#x000A;    },&#x000A;    {&#x000A;      &quot;id&quot;: 1,&#x000A;      &quot;enabled&quot;: false,&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>cashiers</dt>
      <dd>
        Array of <code>Cashier</code> objects to be updated/created.
        <dl>
          <dt>id</dt>
          <dt>name</dt>
          <dt>enabled</dt>
          <dt>icon</dt>
          <dd>
            Base64 encoded data of icon.
            If unspecified, the icon is not updated.
            If specified with <code>null</code>, the icon will be removed.
          </dd>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:12Z&quot;,&#x000A;  &quot;cashiers&quot; : $cashiers&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>cashiers</dt>
      <dd>
        Array of updated/created <code>Cashier</code>s.
      </dd>
    </dl>
  </div>
</div>
          <h1 id='object-payment-type'>PaymentType</h1>
<p><code>PaymentType</code> represents how the bill is payed by; cash? or credit card?</p>
<h2 id='object-payment-type-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>name</dt>
      <dd>Name of the payment type.</dd>
      <dt>position</dt>
      <dd>
        Position of the type. <code>null</code> in the case the payment methods is disabled.
      </dd>
      <dt>change</dt>
      <dd>
        <code>true</code> if customers will receive change.
      </dd>
      <dt>kind</dt>
      <dd>
        One of <code>"cash"</code>, <code>"card"</code>, or <code>"other"</code>.
        <code>"cash"</code> kind payment type exists in all accounts.
      </dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 111,&#x000A;  &quot;name&quot;: &quot;Credit card&quot;,&#x000A;  &quot;position&quot;: 3,&#x000A;  &quot;change&quot;: true,&#x000A;  &quot;kind&quot;: &quot;card&quot;,&#x000A;}</pre>
  </div>
</div>
<h2 id='post-on-accounts-account-id-payment-types'>POST on /accounts/<em>account_id</em>/payment_types</h2>
<p>Change payment type of the account specified by <code>:account_id</code>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;payment_types&quot;: [&#x000A;    {&#x000A;      &quot;name&quot;: &quot;Book Coupon&quot;,&#x000A;      &quot;change&quot;: true,&#x000A;      &quot;kind&quot;: &quot;other&quot;&#x000A;    },&#x000A;    {&#x000A;      &quot;id&quot;: 123,&#x000A;      &quot;change&quot;: false,&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>payment_types</dt>
      <dd>
        Array of <code>PaymentType</code> objects to update/create.
        <dl>
          <dt>id</dt>
          <dt>name</dt>
          <dt>change</dt>
          <dt>kind</dt>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2012-02-14T09:00:00Z&quot;,&#x000A;  &quot;payment_types&quot; : $payment_types&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>payment_types</dt>
    </dl>
  </div>
</div>
          <h1 id='object-category'>Category</h1>
<p><code>Category</code> is set of <code>MenuItem</code>s to organize and help user to input checkouts.</p>
<h2 id='object-category-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>name</dt>
      <dd>Name of the item.</dd>
      <dt>position</dt>
      <dd>
        Position of the category in menu. <code>null</code> if the category is disabled.
      </dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 371,&#x000A;  &quot;name&quot;: &quot;Coke&quot;,&#x000A;  &quot;position&quot;: 1021,&#x000A;}</pre>
  </div>
</div>
<h2 id='get-on-menus-menu-id-categories'>GET on /menus/<em>menu_id</em>/categories</h2>
<p>Retrieves <code>Category</code>s defined in menu specified by <em>menu_id</em>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /menus/13/categories?since=2011-01-01T18:00:13Z</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2012-01-03T03:11:03Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/menus/13/categories?since=2011-01-01T18:00:13Z&amp;until=2011-01-03T03:11:03Z&amp;glb=13476&quot;,&#x000A;  &quot;last-updated-at&quot;: &quot;2012-01-02T21:14:08Z&quot;,&#x000A;  &quot;categories&quot;: [ $categories ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last-updated-at</dt>
      <dt>categories</dt>
    </dl>
  </div>
</div>
<h2 id='post-on-menus-menu-id-categories'>POST on /menus/<em>menu_id</em>/categories</h2>
<p>Update/Create the categories of the menu specified by <em>menu_id</em>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;categories&quot;: [&#x000A;    {&#x000A;      &quot;name&quot;: &quot;Soft drinks&quot;,&#x000A;      &quot;position&quot;: 102,&#x000A;    },&#x000A;    {&#x000A;      &quot;id&quot;: 1022,&#x000A;      &quot;position&quot;: null,&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>items</dt>
      <dd>
        Array of <code>Category</code> objects to be updated/created.
        <dl>
          <dt>id</dt>
          <dt>name</dt>
          <dt>position</dt>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:12Z&quot;,&#x000A;  &quot;categories&quot; : [ $categories ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>categories</dt>
    </dl>
  </div>
</div>
          <h1 id='object-menu-item'>MenuItem</h1>
<p>Item in menus, which represents one product/service you sell.</p>
<h2 id='object-menu-item-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>sku <span class='label immutable'>immutable</span></dt>
      <dd>SKU of the item.</dd>
      <dt>name</dt>
      <dd>Name of the item.</dd>
      <dt>barcode</dt>
      <dd>Barcode of the item.</dd>
      <dt>price_type</dt>
      <dd>
        Note on price. One of <code>"intax"</code>, <code>"outtax"</code>, <code>"percent"</code>, and <code>"nosales"</code>.
        <code>"intax"</code> is used for normal items, such that the VAT is included in the price.
        <code>"outtax"</code> is to mark that the VAT is not included in the price.
        <code>"percent"</code> is for discounting/premiums.
        If <code>"20"</code> is the price of the item and the price_type is <code>"percent"</code>, The price is <em>20% of premier</em>.
        <code>"nosales"</code> is mark that the total sales with this item is not included in sales.
      </dd>
      <dt>price</dt>
      <dd>Price of the item. <strong>Note that price is a string</strong> to avoid inaccurate computation using floats.</dd>
      <dt>vat</dt>
      <dd>
        Percentage of VAT in integer. Present if <code>price_type</code> is <code>"intax"</code> or <code>"outtax"</code>.
      </dd>
      <dt>position</dt>
      <dd>
        Position of the item in its category. <code>null</code> if the item is disabled.
      </dd>
      <dt>category_id</dt>
      <dd>
        The category the item is belonging to. <code>null</code> if the item is disabled.
      </dd>
      <dt>stock <span class='label readonly'>Readonly</span></dt>
      <dd>
        The stocks with respect to <code>StockEvent</code>s.
      </dd>
      <dt>last_inventory_at <span class='label readonly'>Readonly</span></dt>
      <dd>
        The time at which the most recent inventory was made according to <code>StockEvent</code>s.
      </dd>
      <dt>incoming_stock <span class='label readonly'>Readonly</span></dt>
      <dd>
        The number of the item which was ordered but not yet arrived.
      </dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 271,&#x000A;  &quot;sku&quot;: &quot;sku&quot;,&#x000A;  &quot;name&quot;: &quot;Coke&quot;,&#x000A;  &quot;price_type&quot;: &quot;intax&quot;,&#x000A;  &quot;price&quot;: &quot;105&quot;,&#x000A;  &quot;vat&quot;: 5,&#x000A;  &quot;position&quot;: 102,&#x000A;  &quot;category_id&quot;: 105,&#x000A;  &quot;stock&quot;: 103,&#x000A;  &quot;last_inventory_at&quot;: &quot;2012-02-13T14:00:31Z&quot;,&#x000A;  &quot;incoming_stock&quot;: 13,&#x000A;}</pre>
  </div>
</div>
<h2 id='get-on-menus-menu-id-items'>GET on /menus/<em>menu_id</em>/items</h2>
<p>Retrieves the <code>MenuItem</code>s defined in menu specified by <em>menu_id</em>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /menus/13/items?since=2011-01-01T18:00:13Z&#x000A;GET /menus/13/items?sku=item12345&#x000A;GET /menus/13/items?id=123</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
      <dt>sku</dt>
      <dd>
        This parameter is to download a menu item with given sku.
        Since sku is unique in a menu, one or zero item will be retrieved.
      </dd>
      <dt>id</dt>
      <dd>
        This parameter is to download a menu item with given id.
        Since id is unique in a menu, one or zero item will be retrieved.
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2012-01-03T03:11:03Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/menus/13/items?since=2011-01-01T18:00:13Z&amp;until=2011-01-03T03:11:03Z&amp;glb=13476&quot;,&#x000A;  &quot;last-updated-at&quot;: &quot;2012-01-02T21:14:08Z&quot;,&#x000A;  &quot;items&quot;: [ $menu_items ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last-updated-at</dt>
      <dt>items</dt>
    </dl>
  </div>
</div>
<h2 id='post-on-menus-menu-id-items'>POST on /menus/<em>menu_id</em>/items</h2>
<p>Update/Create the menu item of the menu specified by <code>:menu_id</code>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;items&quot;: [&#x000A;    {&#x000A;      &quot;name&quot;: &quot;New menu item&quot;,&#x000A;      &quot;price_type&quot;:&quot;intax&quot;,&#x000A;      &quot;price&quot;: &quot;1000&quot;,&#x000A;      &quot;vat&quot;: 5,&#x000A;      &quot;position&quot;: 102,&#x000A;      &quot;category_id&quot;: 105,&#x000A;    },&#x000A;    {&#x000A;      &quot;id&quot;: 1022,&#x000A;      &quot;name&quot;: &quot;Renamed menu item&quot;,&#x000A;      &quot;price_type&quot;:&quot;percentage&quot;,&#x000A;      &quot;price&quot;: &quot;1500&quot;,&#x000A;      &quot;position&quot;: 103,&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>items</dt>
      <dd>
        Array of <code>MenuItem</code> objects to be updated/created.
        <dl>
          <dt>id</dt>
          <dt>name</dt>
          <dt>price</dt>
          <dt>price_type</dt>
          <dt>vat</dt>
          <dt>position</dt>
          <dt>category_id</dt>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:12Z&quot;,&#x000A;  &quot;items&quot; : $items&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>items</dt>
    </dl>
  </div>
</div>
          <h1 id='object-stock-event'>Stock Event</h1>
<p>Event object related to stock control.
The object is used to tell someone that stock-related event has occured.
Type of a stock event is either "inventory", "arrival", "shipping", or "order".</p>
<h2 id='object-stock-event-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the event.</dd>
      <dt>menu_item_id <span class='label immutable'>immutable</span></dt>
      <dd>ID of the menu item associated with the event.</dd>
      <dt> app_created_at <span class='label writeonly'>Writeonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>Time when the event has been created in a client app.</dd>
      <dt>inventory_at <span class='label immutable'>immutable</span></dt>
      <dd>Time when the inventory event has occured.  It maybe different from <code>app_created_at</code>.</dd>
      <dt>event_type <span class='label immutable'>immutable</span></dt>
      <dd>Type of the event. One of <code>"inventory"</code>, <code>"arrival"</code>, <code>"shipping"</code>, and <code>"order"</code>.</dd>
      <dt>amount <span class='label immutable'>immutable</span></dt>
      <dd>An integer which represents amount of the event</dd>
      <dt>guid <span class='label immutable'>immutable</span></dt>
      <dd>UUID associated to the event.  This is used to prevent duplicated posts.</dd>
      <dt>body <span class='label immutable'>immutable</span></dt>
      <dd>An arbitrary JSON object.  The usage of the value is not decided yet.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot; : 1,&#x000A;  &quot;menu_item_id&quot; : 2,&#x000A;  &quot;app_created_at&quot; : &quot;2012-02-14T00:00:00Z&quot;,&#x000A;  &quot;inventory__at&quot; : &quot;2012-02-14T01:00:00Z&quot;,&#x000A;  &quot;event_type&quot; : &quot;arrival&quot;,&#x000A;  &quot;amount&quot; : 55,&#x000A;  &quot;guid&quot; : $UUID-like-sequence,&#x000A;  &quot;body&quot; : { &quot;note&quot; : &quot;This object represents that 55 items specified by `menu_item_id` has arrived&quot; },&#x000A;}</pre>
  </div>
</div>
<h3>Amount of an Event</h3>
<p>The interpretation of <code>amount</code> depends on the event's <code>event_type</code>.</p>

<p>Assume there is a <code>StockEvent</code> object with <code>amount = 55</code>.
It says the following facts depending on <code>event_type</code>:</p>
<dl>
  <dt>"inventory"</dt>
  <dd>The current stock of the menu is 55.</dd>
  <dt>"arrival"</dt>
  <dd>The number of the items arrived is 55.</dd>
  <dt>"shipping"</dt>
  <dd>The number of the item shipped is 55.</dd>
  <dt>"order"</dt>
  <dd>The number of the item someone ordered is 55.</dd>
</dl>
<h2 id='get-on-accounts-account-id-stocks-events'>GET on /accounts/<em>account_id</em>/stocks/events</h2>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /accounts/current/stocks/events?since=...</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/accounts/1032/stocks/events?since=.....&quot;,&#x000A;  &quot;last_updated_at&quot;: &quot;2011-12-31T00:00:31Z&quot;,&#x000A;  &quot;events&quot;: [ $stock_events ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last_updated_at</dt>
      <dt>events</dt>
    </dl>
  </div>
</div>
<h2 id='post-on-accounts-account-id-stock-events'>POST on /accounts/<em>account_id</em>/stocks/events</h2>
<p>Create <code>StockEvent</code> objects of <code>Account</code> specified by <em>account_id</em>.
Since there is no mutable field in <code>StockEvent</code>, it is impossible to <em>update</em>.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;events&quot;: [&#x000A;    {&#x000A;      &quot;menu_item_id&quot; : 21,&#x000A;      &quot;app_created_at&quot; : &quot;2012-02-14T00:00:00Z&quot;,&#x000A;      &quot;inventory__at&quot; : &quot;2012-02-14T01:00:00Z&quot;,&#x000A;      &quot;event_type&quot; : &quot;arrival&quot;,&#x000A;      &quot;amount&quot; : 55,&#x000A;      &quot;uuid&quot; : $UUID-like-sequence,&#x000A;      &quot;body&quot; : {&#x000A;        &quot;author&quot;: &quot;Soutaro Matsumoto&quot;,&#x000A;      },&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>events</dt>
      <dd>
        Array of <code>StockEvents</code> objects which will be created.
        <dl>
          <dt>menu_item_id</dt>
          <dt>app_created_at</dt>
          <dt>inventory</dt>
          <dt>event_type</dt>
          <dt>amount</dt>
          <dt>uuid</dt>
          <dt>body</dt>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2012-02-14T09:00:00Z&quot;,&#x000A;  &quot;events&quot; : [ $stock_events ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>notes</dt>
    </dl>
  </div>
</div>
          <h1 id='object-checkout'>Checkout</h1>
<p><code>Checkout</code> object represents an checkout/bill.</p>
<h2 id='object-checkout-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object</dd>
      <dt>guid <span class='label immutable'>immutable</span></dt>
      <dd>
        UUID of checkout.
        The ID is generated by clients, thus it may not be unique.
        This is used to prevent a checkout posted from being inserted more than one time.
        The tuple of <code>guid</code>, <code>paid_at</code>, and <code>account_id</code> is used to identify a checkout.
      </dd>
      <dt>account_id <span class='label immutable'>immutable</span></dt>
      <dd>ID of account which the checkout is belonging to.</dd>
      <dt>paid_at</dt>
      <dd>Record when the bill is paid at.</dd>
      <dt>sales_date <span class='label readonly'>Readonly</span></dt>
      <dd>
        The date for <code>paid_at</code> with respect to its account's <code>timezone</code> and <code>date_offset</code>.
        (The example here assumes account's timezone is <code>"Asia/Tokyo"</code> and date_offset is <code>0</code>.)
      </dd>
      <dt>price <span class='label readonly'>Readonly</span></dt>
      <dd><strong>A string</strong> which represents server's calculated total sales of the checkout.</dd>
      <dt>change</dt>
      <dd><strong>A string</strong> which represents change given to the customer.</dd>
      <dt>status</dt>
      <dd>
        The status of the checkout.
        One of <code>"close"</code>, <code>"open"</code>, <code>"deleted"</code>, or <code>"cancel"</code>.
        <code>"close"</code> is for closed checkout, such that the cashier already finished editing the checkout.
        <code>"open"</code> is for open checkout, such that the cashier is continuing editing the checkout.
        <code>"cancel"</code> is for deleted checkout, such that the checkout once was closed, but later canceled.
        <code>"deleted"</code> is for canceled checkout, such that the checkout was deleted without closing it.
      </dd>
      <dt>cashier_id</dt>
      <dd>ID of the cashier who processed the checkout. May be <code>null</code> if input skipped.</dd>
      <dt>customers_count</dt>
      <dd>
        Number of customers associated with the checkout.
        Zero in the case omitted.
      </dd>
      <dt>payments</dt>
      <dd>Array of <code>CheckoutPayment</code>, which describes how the checkout is got paid.</dd>
      <dt>items</dt>
      <dd>Array of <code>CheckoutItem</code>, which describes which items are sold.</dd>
      <dt>table_ids</dt>
      <dd>Array of ID of <code>Table</code>.</dd>
      <dt>customer_tag_ids</dt>
      <dd>Array of ID of <code>CustomerTags</code>.</dd>
      <dt>modifier <span class='label readonly'>Readonly</span></dt>
      <dd>Only for compatibility.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 1,&#x000A;  &quot;guid&quot;: &quot;8928309238-d987aerkeh-9847tdfkzhg4&quot;,&#x000A;  &quot;account_id&quot;: 1,&#x000A;  &quot;paid_at&quot;: &quot;2011-12-24T16:20:20Z&quot;,&#x000A;  &quot;sales_date&quot;: &quot;2011-12-25&quot;,&#x000A;  &quot;price&quot;: &quot;385.0&quot;,&#x000A;  &quot;change&quot;: &quot;4000.0&quot;,&#x000A;  &quot;status&quot;: &quot;close&quot;,&#x000A;  &quot;cashier_id&quot;: null,&#x000A;  &quot;customers_count&quot;: 0,&#x000A;  &quot;payments&quot;: [ $Payments ],&#x000A;  &quot;items&quot;: [ $CheckoutItems ],&#x000A;  &quot;table_ids&quot;: [ 99, 8 ],&#x000A;  &quot;customer_tag_ids&quot;: [ 10, 1003 ],&#x000A;  &quot;modifier&quot;: &quot;0.0&quot;,&#x000A;}</pre>
  </div>
</div>
<h2 id='get-on-accounts-account-id-checkouts'>GET on /accounts/<em>account_id</em>/checkouts</h2>
<p>Retrieves the checkouts of the account which specified with <em>account_id</em>.
The account should be one of current account, parent, children, or siblings.
In other case, the request will result in <code>404</code> not found.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /accounts/current/checkouts&#x000A;GET /accounts/113/checkouts?since=....</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/accounts/31/checkouts?since=.....&quot;,&#x000A;  &quot;last_updated_at&quot;: &quot;2011-12-31T00:00:31Z&quot;,&#x000A;  &quot;checkouts&quot;: [ $checkouts ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last_updated_at</dt>
      <dt>checkouts</dt>
      <dd>Array of <code>Checkout</code>s for the request.</dd>
    </dl>
  </div>
</div>
<h2 id='get-on-accounts-account-id-checkouts-close' style='font-size:30px'>GET on /accounts/<em>account_id</em>/checkouts/close</h2>
<p>Retrieves the <em>closed</em> checkouts of the account which specified with <em>account_id</em>.
Checkout which <code>status</code> is <code>"close"</code> or <code>"cancel"</code> is <em>closed</em> checkout.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /accounts/current/checkouts/close&#x000A;GET /accounts/113/checkouts/close?since=....</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/accounts/31/checkouts/close?since=.....&quot;,&#x000A;  &quot;last_updated_at&quot;: &quot;2011-12-31T00:00:31Z&quot;,&#x000A;  &quot;checkouts&quot;: [ $checkouts ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last_updated_at</dt>
      <dd>The latest <s>closed</s> checkout <code>updated_at</code>.</dd>
      <dt>checkouts</dt>
      <dd>Array of <code>Checkout</code>s for the request.</dd>
    </dl>
  </div>
</div>
<h2 id='post-on-accounts-account-id-checkouts'>POST on /accounts/<em>account_id</em>/checkouts</h2>
<p>Create/update checkout of account with <code>account_id</code>.</p>

<p>Checkouts of current account and its child accounts are writable.
Otherwise, the post request to checkouts will result in <code>400</code> error.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;checkouts&quot;: [&#x000A;    {&#x000A;      &quot;items&quot;: [&#x000A;        {&#x000A;          &quot;menu_item_id&quot;: 123,&#x000A;          &quot;count&quot;: 1,&#x000A;          &quot;sales&quot;: &quot;100&quot;,&#x000A;          &quot;tax&quot;: &quot;5&quot;,&#x000A;          &quot;discount_sales&quot;: &quot;20&quot;,&#x000A;          &quot;discount_tax&quot;: &quot;1&quot;&#x000A;        }&#x000A;      ],&#x000A;      &quot;change&quot; : &quot;26&quot;,&#x000A;      &quot;guid&quot; : $UUID-like-sequence,&#x000A;      &quot;paid_at&quot;: $Time,&#x000A;      &quot;payments&quot;: [&#x000A;        { &quot;payment_type_id&quot;: 101, &quot;amount&quot;: &quot;100&quot; }&#x000A;      ],&#x000A;      &quot;customers_count': 1,&#x000A;      &quot;customer_tag_ids': [ 20 ],&#x000A;      &quot;cashier_id&quot;: 948,&#x000A;      &quot;status&quot;: &quot;Open&quot;,&#x000A;    },&#x000A;    {&#x000A;      &quot;id&quot;: 4739,&#x000A;      &quot;status&quot;: &quot;Close&quot;,&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>checkouts</dt>
      <dd>
        <code>Checkout</code> objects to be created/updated.
        <dl>
          <dt>id</dt>
          <dt>guid</dt>
          <dt>change</dt>
          <dt>status</dt>
          <dt>cashier_id</dt>
          <dt>customers_count</dt>
          <dt>payments</dt>
          <dd>Array of <code>CheckoutPayment</code>s.</dd>
          <dt>items</dt>
          <dd>Array of <code>CheckoutItem</code>s.</dd>
          <dt>table_ids</dt>
          <dd>
            Array of IDs of <code>Table</code>s.
          </dd>
          <dt>customer_tag_ids</dt>
          <dd>
            Array of IDs of <code>CustomerTag</code>s.
          </dd>
        </dl>
      </dd>
    </dl>
    <p>There are validations on creating checkout objects.
    It should be good practice to send all attributes when creating new checkout.</p>
  </div>
</div>
<h4>Updating items and payments</h4>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;checkouts&quot;: [&#x000A;    {&#x000A;      &quot;id&quot;: 123&#x000A;      &quot;payments&quot;: [&#x000A;        {&#x000A;          &quot;payment_type_id&quot;: 13,&#x000A;          &quot;amount&quot;: &quot;1032&quot;,&#x000A;        },&#x000A;        {&#x000A;          &quot;id&quot;: 3112,&#x000A;          &quot;amount&quot;: &quot;809&quot;,&#x000A;        },&#x000A;      ],&#x000A;      &quot;items&quot;: []&#x000A;    },&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <h5>Creating an Object</h5>
    <p>Include an object without <code>id</code>.
    The first <code>payments</code> object is creating an <code>CheckoutPayment</code>.</p>
    <h5>Updating an Object</h5>
    <p>Include an object with <code>id</code> and updating attributes.
    The second <code>payments</code> object is updating <code>amount</code> of a <code>CheckoutPayment</code> with its ID is 3112.</p>
    <h5>Deleting an Object</h5>
    <p>Objects which is not included in the array are deleted.
    All objects in <code>items</code> will be deleted.</p>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;  &quot;checkouts&quot;: [ $checkouts ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>checkouts</dt>
    </dl>
  </div>
</div>
          <h1 id='object-checkout-item'>CheckoutItem</h1>
<p><code>CheckoutItem</code> object represents each sold menu item in a checkout.
It records how many the item sold and the price.</p>
<h2 id='object-checkout-item-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object</dd>
      <dt>menu_item_id</dt>
      <dd>ID of the menu item</dd>
      <dt>count</dt>
      <dd>
        The number of the items the customer bought.
        May be negative to express a return.
      </dd>
      <dt>sales</dt>
      <dd>Sales amount without TAX.</dd>
      <dt>tax</dt>
      <dd>TAX for the item.</dd>
      <dt>discount_sales</dt>
      <dd>Sales discounted</dd>
      <dt>discount_tax</dt>
      <dd>TAX discounted</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 1,&#x000A;  &quot;menu_item_id&quot;: 1,&#x000A;  &quot;count&quot;: 3,&#x000A;  &quot;sales&quot;: &quot;330.0&quot;,&#x000A;  &quot;tax&quot;: &quot;0.0&quot;,&#x000A;  &quot;discount_sales&quot;: &quot;0.0&quot;,&#x000A;  &quot;discount_tax&quot;: &quot;0.0&quot;&#x000A;}</pre>
  </div>
</div>
<h3>Notes</h3>
<p>Make sure the amounts of currency; <code>sales</code>, <code>tax</code>, <code>discount_sales</code>, and <code>discount_tax</code>; are represented as a string, not a number.
The price is calculated as follows: <code>sales</code> + <code>tax</code> - (<code>discount_sales</code> + <code>discount_tax</code>).</p>
          <h1 id='object-checkout-payment'>CheckoutPayment</h1>
<p>Pair of amount the customer paid, and method the payment maid with.</p>
<h2 id='object-checkout-payment-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object</dd>
      <dt>payment_type_id</dt>
      <dd>ID of <code>PaymentType</code></dd>
      <dt>amount</dt>
      <dd>An string which represents the amount customer paid</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 1,&#x000A;  &quot;payment_type_id&quot;: 1,&#x000A;  &quot;amount&quot;: &quot;5000.0&quot;&#x000A;}</pre>
  </div>
</div>
<h3>Notes</h3>
<p>Make sure <code>amount</code> value is a string.</p>
          <h1 id='object-customer'>Customer</h1>
<p><code>Customer</code> object represents a customer, which can be used in Customer Relation Management.</p>
<h2 id='object-customer-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object</dd>
      <dt>account_id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of account which this customer is associated with</dd>
      <dt>fields</dt>
      <dd>
        Array of <code>CustomerField</code> object.
        <code>fields</code> can not be empty.
      </dd>
      <dt>guid <span class='label immutable'>immutable</span></dt>
      <dd>
        An GUID which uniquely identifies the customer.
        The GUID is generated in client side, a client should be careful to read it unique.
      </dd>
      <dt>deleted</dt>
      <dd><code>true</code> if and only if the customer is deleted.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 100,&#x000A;  &quot;account_id&quot;: 2,&#x000A;  &quot;fields&quot;: [ $customer_fields ],&#x000A;  &quot;guid&quot;: $UUID-like-sequence,&#x000A;  &quot;deleted&quot;: true,&#x000A;}</pre>
  </div>
</div>
<h2 id='get-on-customers'>GET on /customers</h2>
<p>Retrieve collection of customers available for the account.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /customers?since=...</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/customers?since=.....&quot;,&#x000A;  &quot;last_updated_at&quot;: &quot;2011-12-31T00:00:31Z&quot;,&#x000A;  &quot;customers&quot;: [ $customers ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last_updated_at</dt>
      <dt>customers</dt>
    </dl>
  </div>
</div>
<h3>Available Customers</h3>
<p>An customer is available only if the customer is associated with one of the following:</p>

<ol>
<li>Current account's parents</li>
<li>Current account's children</li>
<li>Current account's siblings</li>
</ol>
<img src='images/available-customers.png'>
<p>The circles represent accounts and gray arrows represents parent-child associations.
Accounts covered with purple background are accessible accounts, so that their accounts
are available to current account (the red one).</p>
<h2 id='post-on-customers'>POST on /customers</h2>
<p>Create an <code>Customer</code> objects, or update <code>Customer</code> objects available for current account.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;customers&quot;: [&#x000A;    {&#x000A;      &quot;guid&quot;: $UUID-like-sequence,&#x000A;      &quot;deleted&quot;: false,&#x000A;      &quot;updated_fields&quot;: [ $customer_fields ],&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>customers</dt>
      <dd>
        Array of <code>Customer</code> objects which will be updated/created.
        <dl>
          <dt>guid</dt>
          <dt>deleted</dt>
          <dt>updated_fields</dt>
          <dd>
            Array of updated or newly inserted <code>CustomerField</code>s.
          </dd>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2012-02-14T09:00:00Z&quot;,&#x000A;  &quot;customers&quot; : [ $customers ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>customers</dt>
    </dl>
  </div>
</div>
<h3>updated_fields</h3>
<p>It is not allowed to destroy <code>CustomerField</code>s.
Thus, <code>fields</code> attribute in POST requests are not defined, but <code>updated_fields</code> should be used instead.
To (logically) destroy <code>CustomerField</code>s, set its <code>deleted</code> field to <code>true</code>.</p>
          <h1 id='object-customer-field'>CustomerField</h1>
<p>A customer field belongs to a customer.
This is mainly used to be included in a customer object.</p>
<h2 id='object-customer-field-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of the object.</dd>
      <dt>guid <span class='label immutable'>immutable</span></dt>
      <dd>GUID.</dd>
      <dt>app_created_at <span class='label writeonly'>Writeonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>Time when the field has been created in a client app.</dd>
      <dt>name <span class='label immutable'>immutable</span></dt>
      <dd>Name of the field.</dd>
      <dt>value</dt>
      <dd>Value in string of the field</dd>
      <dt>deleted</dt>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 1345,&#x000A;  &quot;guid&quot;: $UUID-like-sequence,&#x000A;  &quot;app_created_at&quot;: &quot;2012-02-14T00:00:00Z&quot;,&#x000A;  &quot;name&quot;: &quot;customer.field.name&quot;,&#x000A;  &quot;value&quot;: &quot;Ubiregi Taro&quot;,&#x000A;  &quot;deleted&quot;: false,&#x000A;}</pre>
  </div>
</div>
<h3>Customer Attributes</h3>
<dl>
  <dt><em>Field Name</em></dt>
  <dd><em>Description</em></dd>
</dl>
<dl>
  <dt>"customer.field.customerID"</dt>
  <dd>
    Arbitary customer ID.
    The interpretation depends on the client.
  </dd>
  <dt>"customer.field.name"</dt>
  <dd>
    Name of the customer.
  </dd>
  <dt>"customer.field.ruby"</dt>
  <dd>
    Ruby of the name.
  </dd>
  <dt>"customer.field.birthday"</dt>
  <dd>
    Birthday.
    The birthday value is expected to be formatted in <code>YYYY-MM-DD</code>,
    where <code>YYYY</code> is year in 4 digits, <code>MM</code> is month in 2 digits, and <code>DD</code> is day in 2 digits.
  </dd>
  <dt>"customer.field.sex"</dt>
  <dd>
    Sex of the customer.
    The value is expected to be one of <code>"F"</code> and <code>"M"</code>, for female and male, respectively.
  </dd>
  <dt>"customer.field.email"</dt>
  <dd>Email address of the customer.</dd>
  <dt>"customer.field.phone"</dt>
  <dd>Phone number of the customer.</dd>
  <dt>"customer.field.twitter"</dt>
  <dd>Twitter ID of the customer, without <code>@</code>.</dd>
  <dt>"customer.field.zip"</dt>
  <dd>Zip code of the customer.</dd>
  <dt>"customer.field.address1"</dt>
  <dt>"customer.field.address2"</dt>
  <dd>
    Address of the customer.
    <code>address1</code> is expected to be an address.
    <code>address2</code> is expected to be additional information, like room number or building number.
  </dd>
</dl>
<h3>Updating CustomerField</h3>
<p>Updating value of a <code>CustomerField</code> object is not recommended.
Just create new field, and delete it (set <code>deleted</code>).</p>

<p>This is to avoid conflicting changes in two places, for example in your app and in the Ubiregi iPad app.
If you do not update an existing <code>CustomerField</code>, the conflict will result in duplicated fields, and
user can choose one, and then delete the other. This is safe.</p>
          <h1 id='object-customer-note'>CustomerNote</h1>
<p>A customer note belongs to a customer.</p>
<h2 id='object-customer-note-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>id <span class='label readonly'>Readonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>ID of this object.</dd>
      <dt>customer_id <span class='label immutable'>immutable</span></dt>
      <dd>ID which their object belongs to.</dd>
      <dt>app_created_at <span class='label writeonly'>Writeonly</span> <span class='label immutable'>immutable</span></dt>
      <dd>Time when the note is created in a client app</dd>
      <dt>guid <span class='label immutable'>immutable</span></dt>
      <dd>GUID</dd>
      <dt>checkout_id <span class='label immutable'>immutable</span></dt>
      <dd>ID of <code>Checkout</code> object, which the note is associated with.</dd>
      <dt>kind</dt>
      <dd>
        <code>"icon"</code> or <code>null</code>.
        <code>"icon"</code> in the case the <code>photo</code> is icon of the customer.
      </dd>
      <dt>note</dt>
      <dd>Comment.</dd>
      <dt>photo</dt>
      <dd>
        Base64 encoded photo data, resized to 256px x 256px (for thumbnail).
      </dd>
      <dt>photo_url <span class='label readonly'>Readonly</span></dt>
      <dd>URL of full size photo. May be absent. (we are working for this.)</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;id&quot;: 1,&#x000A;  &quot;customer_id&quot;: 1,&#x000A;  &quot;app_created_at&quot;: &quot;2012-02-14T00:00:00Z&quot;,&#x000A;  &quot;guid&quot;: $UUID-like-sequence,&#x000A;  &quot;checkout_id&quot;: 2,&#x000A;  &quot;kind&quot;: &quot;icon&quot;,&#x000A;  &quot;note&quot;: &quot;Memo Memo&quot;,&#x000A;  &quot;photo&quot;: $base64Encoded,&#x000A;  &quot;checkout_summary&quot;: &quot;Summary&quot;&#x000A;}</pre>
  </div>
</div>
<h3>Note on Photo</h3>
<p><strong>Writing Photo</strong> &nbsp;&nbsp;
When you are uploading <code>CustomerNote</code>, <code>photo</code> data is expected to be <em>full size</em> photo data.</p>

<p><strong>Reading Photo</strong> &nbsp;&nbsp;
When you are downloading <code>CustomerNote</code>, <code>photo</code> attribute is <em>thumbnail</em> generated in ubiregi.com server.
The thumbnail is 256px x 256px size, JPEG data.
The size should be convenient for many cases in your app to show a thumbnail to users.
In the case you really need full size data, access the <code>photo_url</code> and download it.</p>
<h2 id='get-on-customers-notes'>GET on /customers/notes</h2>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>GET /customers/notes?since=...</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>since</dt>
      <dt>until</dt>
      <dt>glb</dt>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2011-11-02T09:11:34Z&quot;,&#x000A;  &quot;next-url&quot;: &quot;https://ubiregi.com/api/3/customers?since=.....&quot;,&#x000A;  &quot;last_updated_at&quot;: &quot;2011-12-31T00:00:31Z&quot;,&#x000A;  &quot;notes&quot;: [ $customer_notes ],&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>next-url</dt>
      <dt>last_updated_at</dt>
      <dt>notes</dt>
    </dl>
  </div>
</div>
<h3>Available CustomerNotes</h3>
<p>A <code>CustomerNote</code> is available only if the note is associated with available <code>Customer</code>.</p>
<h2 id='post-on-customers-notes'>POST on /customers/notes</h2>
<p>Create a <code>CustomerNote</code> objects, or update <code>CustomerNote</code> objects available for current account.</p>
<h3>Request</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;notes&quot;: [&#x000A;    {&#x000A;      &quot;id&quot;: 1,&#x000A;      &quot;customer_id&quot;: 1,&#x000A;      &quot;app_created_at&quot;: &quot;2012-02-14T00:00:00Z&quot;,&#x000A;      &quot;guid&quot;: $UUID-like-sequence,&#x000A;      &quot;checkout_id&quot;: 2,&#x000A;      &quot;kind&quot;: &quot;icon&quot;,&#x000A;      &quot;note&quot;: &quot;Memo Memo&quot;,&#x000A;      &quot;photo&quot;: $base64Encoded,&#x000A;      &quot;checkout_summary&quot;: &quot;Summary&quot;&#x000A;    }&#x000A;  ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>notes</dt>
      <dd>
        Array of <code>CustomerNote</code> objects which will be updated/created.
        <dl>
          <dt>id</dt>
          <dt>customer_id</dt>
          <dd><code>Customer</code> for the <code>customer_id</code> should be available from current account.</dd>
          <dt>app_created_at</dt>
          <dt>guid</dt>
          <dt>checkout_id</dt>
          <dd>Should be ID of <code>Checkout</code> of current account.</dd>
          <dt>kind</dt>
          <dt>note</dt>
          <dt>photo</dt>
          <dt>checkout_summary</dt>
        </dl>
      </dd>
    </dl>
  </div>
</div>
<h3>Response</h3>
<div class='row'>
  <div class='span6'>
    <pre>{&#x000A;  &quot;timestamp&quot;: &quot;2012-02-14T09:00:00Z&quot;,&#x000A;  &quot;notes&quot; : [ $customer_notes ]&#x000A;}</pre>
  </div>
  <div class='span6'>
    <dl>
      <dt>timestamp</dt>
      <dt>notes</dt>
    </dl>
  </div>
</div>
          <hr />
          <h1 id='api-notes'>API Notes</h1>
<h2>IDs are Universal</h2>
<p>There are only one scope of ID, <em>Universal</em>.</p>

<p>If this doc says <em>ID</em>, it is an one origin integer value which uniquely determines an object on ubiregi server.</p>
<h2>Special Fields</h2>
<p>Most objects have special fields, <code>created_at</code> and <code>updated_at</code>.</p>
<dl>
  <dt>created_at <span class='label readonly'>Readonly</span></dt>
  <dd>
    Server time at which the object is created.
  </dd>
  <dt>updated_at <span class='label readonly'>Readonly</span></dt>
  <dd>
    Server time at which the object is updated.
  </dd>
</dl>
<h2>Permissions on Objects of Other Accounts</h2>
<p>Ubiregi API permission model is very simple.
The permission to a object is decided by its owner account's <em>role</em>.</p>

<p>There are three permissions, <em>nothing</em>, <em>readonly</em> and <em>writable</em>.</p>
<dl>
  <dt>nothing</dt>
  <dd>Any access will be rejected.</dd>
  <dt>readonly</dt>
  <dd>Reading is allowed, but can not update.</dd>
  <dt>writable</dt>
  <dd>Full access allowed.</dd>
</dl>
<p>There are five roles, <em>current</em>, <em>children</em>, <em>parents</em>, <em>siblings</em>, and <em>others</em>.</p>
<dl>
  <dt>current</dt>
  <dd>The account which is authenticated.</dd>
  <dt>children</dt>
  <dd>Children of current account.</dd>
  <dt>parents</dt>
  <dd>The accounts of which the current account is a child.</dd>
  <dt>siblings</dt>
  <dd>The accounts which shares parents with current account.</dd>
  <dt>others</dt>
  <dd>Accounts which is not current, children, parents, and siblings.</dd>
</dl>
<p>The permission is defined as following:</p>
<dl>
  <dt>readonly</dt>
  <dd>Parents' and siblings' information, menus, checkouts, and stock events.</dd>
  <dt>writable</dt>
  <dd>Current's and children information, menus, checkouts, and stock events.</dd>
  <dt>nothing</dt>
  <dd>Anything else.</dd>
</dl>
<p>and it is figured out as following.</p>
<img src='images/object-permissions.png'>
<p>Each circle represents an <code>Account</code>.
Gray arrows represent parent-child links between accounts.
Red, green, blue, purple, and gray circles represent <em>current</em>, <em>children</em>, <em>parents</em>, <em>siblings</em>, and <em>others</em> accounts respectively.
Green background is for the object which owns objects with <em>writable</em> permission, and light-pink background is for <em>readonly</em> permission.</p>

<p>Note that <code>Customer</code>s have their own permission model.</p>
<h2>Stock Calculation Model</h2>
<p>Each <code>MenuItem</code> has its own stock count.
<code>stock</code>, <code>last_inventory_at</code>, and <code>incoming_stock</code> are updated when new <code>StockEvent</code> is created.</p>
<dl>
  <dt>last_inventory_at</dt>
  <dd>
    Find the latest <code>inventory</code> event, and set its <code>inventory_at</code>.
  </dd>
  <dt>stock</dt>
  <dd>
    Find the <em>latest_inventory_event</em> and its <em>following_events</em>, and calculate the following:
    <blockquote>
    <em>last_inventory_amount</em> - <em>shipped_amount</em> + <em>arrived_amount</em><br>
    where:
    <blockquote>
    <em>last_inventory_amount</em> = <em>latest_inventory_event</em>.<code>amount</code><br>
    <em>shipped_amount</em> = Σ <em>following_shipping_events</em>.<code>amount</code><br>
    <em>arrived_amount</em> = Σ <em>arrival_events</em>.<code>amount</code><br>
    </blockquote>
    </blockquote>
  </dd>
  <dt>incoming_stock</dt>
  <dd>
    Calculate all <em>order_events</em> and <em>arrival_events</em>, and calculate the following:
    <blockquote>
    Σ <em>order_events</em>.<code>amount</code> - Σ <em>arrival_events</em>.<code>amount</code>
    </blockquote>
  </dd>
</dl>
<h2>app_created_at Usage</h2>
<p><code>app_created_at</code> field is to remember when the object is created in the iPad app.
It generally meaningless; iPad clock may be inaccurate, the clock can easily changed.</p>

<p>It is recommended to record some time, or just use the time of post.</p>
<h2>Private Fields</h2>
<p>There may be private fields, not defined in this document but you find in the response from server.
It is okay if you use these fields, but keep in your mind <em>they are private</em> so that it may be removed without any announcement.</p>
<h2>Downloading Images</h2>
<p>Image fields including <code>icon</code> and <code>photo</code> are <code>null</code> by default.
This is to reduce the size of data transmission.</p>

<p>To download the image data, give an http query parameter <code>image=blob</code>.</p>
<h3>Example: Downloading with Icons</h3>
<blockquote><p>GET /accounts/current?image=blob</p>

<p>GET /accounts/customer/notes?image=blob</p></blockquote>
          <h1 id='errors'>Errors</h1>
<p>Errors are notified via HTTP response status. Error code are following
the standard HTTP error code convention. If there are something bad in
your request, you will get <code>4xx</code>. If there are something wrong
happen on the server, you will get <code>5xx</code>.</p>
<h2 id='errors-status-code'>Status code</h2>
<p>
  We define four status code, where the meaning is shared between all requests.
</p>
<dl>
  <dt>401 (Unauthorized)</dt>
  <dd>The request does not contains valid authentication token for your application.</dd>
  <dt>403 (Forbidden)</dt>
  <dd>
    Your request is rejected by the server.  For example, if you modify read-only
    attribute, status code 403 is returned.
  </dd>
  <dt>404 (Not Found)</dt>
  <dd>
    Resources client want to require is not found.  If the status code is 404,
    we recommend you to check account id, menu id, customer id, and so on in request JSON.
  </dd>
</dl>
<h2 id='errors-error-object'>Error object</h2>
<p>The error response contains JSON object which represents the detail of the error.  The format
of Error object is as the followings:</p>
<h2 id='errors-error-object-fields'>Fields</h2>
<div class='row'>
  <div class='span6'>
    <dl>
      <dt>errors <span class='label readonly'>Readonly</span></dt>
      <dd>
        Array of an object.
        <dl>
          <dt>object <span class='label readonly'>Readonly</span></dt>
          <dd>A JSON object included in request JSON that related to the reason why this request failed.</dd>
          <dt>messages <span class='label readonly'>Readonly</span></dt>
          <dd>An array of error messages.</dd>
        </dl>
      </dd>
      <dt>timestamp <span class='label readonly'>Readonly</span></dt>
      <dd>The server time that a request failed.</dd>
    </dl>
  </div>
  <div class='span6'>
    <pre>{&#x000A;  &quot;errors&quot;: [&#x000A;    {&#x000A;      &quot;object&quot; : {&#x000A;        &quot;name&quot;: &quot;Existing Cashier&quot;,&#x000A;        &quot;enabled&quot;:true,&#x000A;        &quot;icon&quot;:&quot;hogehoge&quot;&#x000A;      },&#x000A;      &quot;messages&quot;: [&quot;invalid icon&quot;]&#x000A;    }&#x000A;  ],&#x000A;  &quot;timestamp&quot;: &quot;2012-03-11T09:00:00Z&quot;&#x000A;}</pre>
  </div>
</div>
          <hr />
        </div>
      </div>
    </div>
  </body>
</html>
